{{- if not (eq .os "linux-arch") -}} {{- abortEmpty -}} {{- end -}}
#!/usr/bin/env nu

print $"(ansi bb)dotfiles:(ansi rst) installing aur packages"

let timeout = 1 # seconds
let url = "aur.archlinux.org"
let status = (ping -w $timeout $url | complete)

if ($status.exit_code != 0) {
    print $"(ansi rb)dotfiles:(ansi rst) aur unreachable. aborting..."
    exit $status.exit_code
}

let pkgs = [
{{- range .packages.arch.aur }}
    {{ . | quote -}}
{{ end }}
] | to text

if ($pkgs | is-empty) {
    exit
}

# dash at the end for the packages from stdin
$pkgs | (paru -Sy --needed --noconfirm --useask --sudoloop
    --aur --skipreview --norebuild --noredownload --batchinstall -)
